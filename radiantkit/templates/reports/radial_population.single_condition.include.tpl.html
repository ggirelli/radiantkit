<form id="radial_population-dpath-selector" class="mb-2">
	<select name="radial_population-dpath" id="radial_population-dpath" class="form-control">
		{% for dpath in plt_data.keys()|sort: %}
		<option value="{{dpath|basename}}">{{dpath|basename}}</option>
		{% endfor %}
	</select>
</form>

{% for dpath in plt_data.keys()|sort: %}
{% set dtype_list = plt_data[dpath][dpath|basename].keys() %}
<form id="radial_population-{{dpath|basename}}-dtype-selection-form" class="radial_population-dtype-selection-form" style="display: none;">
	<div class="form-group row">
		<label for="distance_type" class="col-sm-2 col-form-label text-right"><b>Distance type:</b></label>
		<div class="col-sm-10">
			<select class="form-control" name="distance_type" id="radial_population-{{dpath|basename}}-distance_type">
				{% for dtype in dtype_list: %}
				<option value="{{dtype.value}}"{% if dtype.value == "lamina_dist_norm": %} selected{% endif %}>{{dtype.label}}</option>
				{% endfor %}
			</select>
		</div>
	</div>
</form>

{% for dtype in dtype_list: %}
{% set channel_list = plt_data[dpath][dpath|basename][dtype].keys() %}
<form id="radial_population-{{dpath|basename}}-{{dtype.value}}-channel-selection-form" class="radial_population-channel-selection-form" style="display: none;">
	<div class="form-group row">
		<label for="channel" class="col-sm-2 col-form-label text-right"><b>Channel:</b></label>
		<div class="col-sm-10">
			<select class="form-control" name="channel" id="channel">
				{% for cname in channel_list %}
				<option value="{{cname}}"{% if cname == ref_channel: %} selected{% endif %}>{{cname}}</option>
				{% endfor %}
			</select>
		</div>		
	</div>
</form>

{% for cname in channel_list: %}
<div id="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-canvas" class="radial_population-canvas" style="display: none;">


	<div class="card">
		<div class="card-header">
			<ul class="nav nav-tabs card-header-tabs" role="tablist">
				<li class="nav-item">
					<a href="#radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-plot-wrap" class="nav-link active" id="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-plot-tab" data-toggle="tab" role="tab" aria-controls="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-plot-wrap" aria-selected="true">Plot</a>
				</li>
				<li class="nav-item">
					<a href="#radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-roots-wrap" class="nav-link" id="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-roots-tab" data-toggle="tab" role="tab" aria-controls="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-roots-wrap" aria-selected="false">Roots</a>
				</li>
			</ul>
		</div>
		<div class="card-body tab-content">
			<div class="tab-pane fade show active" id="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-plot-wrap" role="tabpanel" aria-labelledby="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-plot-tab">
				<div class="plot" id="radial_population-{{dpath|basename}}-{{dtype}}-{{cname}}-profile" class="mx-auto" style="width: 1000px"></div>
				<script>
					CONTAINER = document.getElementById('radial_population-{{dpath|basename}}-{{dtype}}-{{cname}}-profile');
					PLOT_JSON_{{dpath|basename}}_{{dtype.value}}_{{cname}} = {{ plt_data[dpath][dpath|basename][dtype][cname] | safe }};
					Plotly.newPlot( CONTAINER, PLOT_JSON_{{dpath|basename}}_{{dtype.value}}_{{cname}}.data, PLOT_JSON_{{dpath|basename}}_{{dtype.value}}_{{cname}}.layout, {"responsive":true, "displayModeBar":true})
				</script>
			</div>
			<div class="tab-pane fade" id="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-roots-wrap" role="tabpanel" aria-labelledby="radial_population-{{dpath|basename}}-{{dtype.value}}-{{cname}}-roots-tab">
				Roots. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rerum esse illum fugit suscipit maxime recusandae, non modi amet possimus sunt dolorum veniam, consectetur nobis excepturi ratione voluptatem magnam officia porro.
			</div>

			
		</div>
	</div>
</div>
{% endfor %}
{% endfor %}
{% endfor %}

<script type="text/javascript">
function hide_radial_population_canvas() {
	$(".radial_population-canvas").css({'display':'none'})
}
function hide_radial_population_dtype_selectors() {
	$(".radial_population-dtype-selection-form").css({'display':'none'});
}
function set_radial_population_dtype_selectors(v) {
	$(".radial_population-dtype-selection-form select").each(function() {
		$(this).val(v);
	});
}
function hide_radial_population_channel_selectors() {
	$(".radial_population-channel-selection-form").css({'display':'none'});
}
function set_radial_population_channel_selectors(v) {
	$(".radial_population-channel-selection-form select").each(function() {
		$(this).val(v);
	});
}
function show_radial_population_selection() {
	dpath = $("#radial_population-dpath").val();
	$("#radial_population-"+dpath+"-dtype-selection-form").css({'display':'block'});
	dtype = $("#radial_population-"+dpath+"-dtype-selection-form").find('select').val();
	$("#radial_population-"+dpath+"-"+dtype+"-channel-selection-form").css({'display':'block'});
	cname = $("#radial_population-"+dpath+"-"+dtype+"-channel-selection-form").find('select').val();
	$("#radial_population-"+dpath+"-"+dtype+"-"+cname+"-canvas").css({'display':'block'});
}
function radial_population_init_plot() {
	hide_radial_population_canvas();
	hide_radial_population_dtype_selectors();
	hide_radial_population_channel_selectors();
	show_radial_population_selection();
}

$(function() {
	radial_population_init_plot();
	$("#radial_population-dpath-selector").change(function(e) {
		e.preventDefault();
		radial_population_init_plot();
	});
	$(".radial_population-dtype-selection-form").change(function(e) {
		e.preventDefault();
		set_radial_population_dtype_selectors($(this).find("select").val());
		radial_population_init_plot();
	});
	$(".radial_population-channel-selection-form").change(function(e) {
		e.preventDefault();
		set_radial_population_channel_selectors($(this).find("select").val());
		radial_population_init_plot();
	});
})
</script>
